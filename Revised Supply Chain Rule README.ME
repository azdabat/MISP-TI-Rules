# üß© Supply-Chain Compromise / Signed Binary Drift & DLL-Driver Abuse Detection
**Author:** Ala Dabat  
**Platform:** Microsoft Defender / Sentinel (Advanced Hunting ‚Äì Native KQL)  
**Classification:** L3 Threat Hunt / Analytic Rule  
**Version:** 2.1 (Enhanced for Integrity Drift)  
**Last Updated:** 2025-11-11  

---

## üîç Overview
This rule detects **supply-chain compromises** and **signed binary abuse** on endpoints by correlating:
- Signed but **tampered vendor binaries** (version/signature drift)
- **DLL sideloading** and **driver injection** abuse
- **Registry persistence** (ServiceDll, InprocServer32, Run keys)
- **Dormant or delayed activation** typical of SolarWinds/3CX-style implants  
- **Network, process, and driver context** for kill-chain correlation  

It introduces **integrity-drift analytics** to identify binaries whose signature, hash, or version differs from the organization‚Äôs baseline, signaling a potential **compromised update or malicious rebuild**.

---

## ‚öôÔ∏è Detection Logic Summary

| Component | Purpose |
|------------|----------|
| `DeviceFileEvents` | Tracks DLL/EXE/driver creation and version/signature drift |
| `DeviceImageLoadEvents` | Identifies execution or load of suspicious DLLs |
| `DeviceRegistryEvents` | Flags registry-based persistence mechanisms |
| `DeviceEvents` | Detects driver loads (including file-less BYOVD) |
| `DeviceNetworkEvents` | Adds C2 or callback context |
| `OrgPrevalence` | Baselines file rarity across the tenant |
| `IntegrityDrift` | Detects signer/version/hash drift of signed apps |

---

## üß† Detection Methodology

The rule computes:
- **BehaviorScore** ‚Üí Execution timing, rarity, unsigned state, vendor loader
- **KillChainScore** ‚Üí Driver / registry persistence correlation
- **RecencyScore** ‚Üí Prioritizes new activity  
- **FinalScore = 0.6√óBehavior + 0.3√óKillChain + 0.1√óRecency**

Then classifies as:
| Severity | Threshold | Action |
|-----------|------------|--------|
| **ALERT** | ‚â• 75 | Trigger incident, isolate host |
| **HUNT** | 40‚Äì74 | Investigate, pivot across estate |
| **LOG** | < 40 | Baseline / telemetry only |

---

## üß© MITRE ATT&CK Mapping
| Tactic | Technique ID | Description |
|--------|---------------|-------------|
| **Persistence** | `T1547.*` | Registry & service DLL persistence |
| **Defense Evasion** | `T1574.002` | DLL Search Order Hijacking |
| **Privilege Escalation** | `T1547.006` | Driver-based persistence |
| **Execution** | `T1055` | Indirect code load (via DLL/driver) |
| **Command & Control** | `T1071`, `T1105` | Network beaconing / data transfer |
| **Defense Evasion** | `T1553.002` | Code-signing certificate abuse |

---

## üß© Detection Capabilities by Attack Type

| Attack Type | Example | Coverage |
|--------------|----------|-----------|
| DLL sideloading | SolarWinds, 3CX | ‚úÖ Full |
| Signed driver abuse | F5, BlackByte | ‚úÖ Full |
| Dormant loaders | SUNBURST, CCleaner | ‚úÖ Full |
| Registry persistors | Run / ServiceDll keys | ‚úÖ Full |
| Version/signature drift | Vendor app tampering | ‚úÖ Full |
| File-less in-memory load | Reflective injection | ‚öô Partial |
| Pure cloud/SaaS compromise | Okta / CircleCI | ‚ùå Out of scope |

---

## üß© Example Attack Chains Detected

### 1Ô∏è‚É£ SolarWinds / SUNBURST Pattern
